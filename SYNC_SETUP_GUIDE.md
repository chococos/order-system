# 📱 複数デバイス同期セットアップガイド

## 🎯 概要
このガイドでは、受注情報を複数のデバイス間で同期できるようにするための設定手順を説明します。

## ✨ 新機能

### 1. **リアルタイム同期**
- 他のデバイスで行われた変更が即座に反映されます
- WebSocketを使用したリアルタイム通信

### 2. **オフライン対応**
- インターネット接続がなくてもローカルで作業可能
- オンライン復帰時に自動的に同期

### 3. **競合解決**
- 複数デバイスで同時編集した場合の自動競合解決
- 最新の変更を優先するアルゴリズム

### 4. **同期状態の可視化**
- 画面右上に同期状態を常時表示
- 保留中の変更数をリアルタイム表示

## 🔧 セットアップ手順

### ステップ1: Supabaseアカウントの作成

1. [Supabase](https://supabase.com) にアクセス
2. 「Start your project」をクリック
3. GitHubまたはメールでアカウント作成
4. 新しいプロジェクトを作成

### ステップ2: データベースのセットアップ

1. Supabaseダッシュボードにログイン
2. 左側メニューから「SQL Editor」を選択
3. `setup-supabase.sql`ファイルの内容をコピー
4. SQL Editorに貼り付けて実行
5. 「Success」メッセージを確認

### ステップ3: API認証情報の設定

1. Supabaseダッシュボードの「Settings」→「API」へ移動
2. 以下の情報をコピー：
   - **Project URL**: `https://xxxxx.supabase.co`
   - **anon public key**: `eyJhbGci...`

3. `supabase-config.js`ファイルを編集：
```javascript
const SUPABASE_CONFIG = {
    url: 'YOUR_PROJECT_URL',  // ここに貼り付け
    anonKey: 'YOUR_ANON_KEY'  // ここに貼り付け
};
```

### ステップ4: 認証の設定

1. Supabaseダッシュボードで「Authentication」→「Providers」
2. 「Email」を有効化
3. 必要に応じて他の認証方法も設定（Google、Apple等）

### ステップ5: リアルタイムの有効化

1. Supabaseダッシュボードで「Database」→「Replication」
2. 「orders」テーブルのReplicationを有効化
3. すべてのイベント（INSERT、UPDATE、DELETE）をチェック

## 🚀 使い方

### 初回ログイン

1. アプリケーションにアクセス
2. 「ログイン」画面でアカウント作成
3. メールアドレスとパスワードを設定
4. 確認メールのリンクをクリック

### 同期状態の確認

- **画面右上の同期アイコン**
  - 🟢 緑：オンライン（同期中）
  - 🔵 青：同期処理中
  - 🔴 赤：オフライン
  
- **同期状態をクリックすると詳細表示**
  - 最終同期時刻
  - 保留中の変更数
  - 接続状態

### 手動同期

1. 同期アイコンをクリック
2. 「今すぐ同期」ボタンを押す
3. 同期完了の通知を確認

### デバッグツール

診断ツールへのアクセス：
```
https://your-domain/sync-debug.html
```

このツールで以下が可能：
- 接続テスト
- 同期状態の詳細確認
- ログの確認
- テストデータの作成

## 🔍 トラブルシューティング

### 同期されない場合

1. **インターネット接続を確認**
   - Wi-Fi/モバイルデータが有効か確認
   
2. **Supabase設定を確認**
   - API URLとKeyが正しいか確認
   - `sync-debug.html`で接続テスト実行

3. **ブラウザキャッシュをクリア**
   - Ctrl+Shift+R（Windows）
   - Cmd+Shift+R（Mac）

4. **ログを確認**
   - ブラウザのコンソール（F12）でエラーを確認
   - `sync-debug.html`のシステムログを確認

### データが重複する場合

1. 同期状態を確認（保留中の変更がないか）
2. 「今すぐ同期」を実行
3. それでも解決しない場合は`sync-debug.html`で「保留クリア」

### オフラインで作業したデータが消える

1. オフライン中のデータはLocalStorageに保存されています
2. オンライン復帰時に自動同期されます
3. 手動で「今すぐ同期」を実行して強制同期

## 📊 パフォーマンス最適化

### 推奨設定

- **自動同期間隔**: 5秒（デフォルト）
- **最大保留変更数**: 100件
- **キャッシュ有効期限**: 30秒

### データ量が多い場合

1. 定期的に古いデータを削除
2. 完了したオーダーをアーカイブ
3. 不要なログをクリア

## 🔐 セキュリティ

### Row Level Security (RLS)

- すべてのデータはユーザー認証で保護
- 他のユーザーのデータは見えません
- チーム共有が必要な場合は別途設定が必要

### バックアップ

1. **自動バックアップ**
   - Supabaseが毎日自動バックアップ
   
2. **手動バックアップ**
   - Supabaseダッシュボードからエクスポート可能
   - ローカルデータは`sync-debug.html`からエクスポート

## 📞 サポート

問題が解決しない場合：

1. `sync-debug.html`でログをエクスポート
2. エラーメッセージのスクリーンショットを取る
3. 以下の情報と共に報告：
   - 使用デバイス（iPhone/Android/PC）
   - ブラウザ（Safari/Chrome/Firefox）
   - 発生時刻
   - 実行していた操作

## 🎉 同期システムの利点

- **どこでも作業可能**: スマホ、タブレット、PCから同じデータにアクセス
- **リアルタイム更新**: チーム全員が最新情報を共有
- **データ損失防止**: クラウドバックアップで安心
- **オフライン対応**: ネット環境がなくても作業継続可能
- **自動競合解決**: 同時編集も問題なし

---

設定完了後は、複数のデバイスからログインして同期機能をお試しください！