<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>„Ç™„Éº„ÉÄ„Éº„Ç∑„Éº„Éà ver.0.9</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK (v9 compatÁâà) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- FirebaseË®≠ÂÆö„Å®„Éû„Éç„Éº„Ç∏„É£„Éº -->
    <script src="firebase-config.js"></script>
    <script src="firebase-auth.js"></script>
    <script src="firebase-database.js"></script>
    <script src="firebase-adapter.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sage: '#8B9A8C',
                        'sage-light': '#A8B5A9',
                        'sage-dark': '#6B7A6C',
                        cream: '#F7F5F3',
                        'cream-dark': '#F0EDE8',
                        terracotta: '#D4A574',
                        'terracotta-light': '#E2C4A0',
                        forest: '#2D3E2F'
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="style.css">
    
    <!-- „É≠„Ç∞„Ç§„É≥„Çπ„Ç≠„ÉÉ„ÉóË®≠ÂÆö -->
    <script>
        // „É≠„Ç∞„Ç§„É≥„Å™„Åó„Åß‰ΩøÁî®„Åô„ÇãÂ†¥Âêà„ÅØtrue„Å´Ë®≠ÂÆö
        const SKIP_LOGIN_REQUIREMENT = false; // „É≠„Ç∞„Ç§„É≥ÂøÖÈ†à„É¢„Éº„Éâ
        const USE_LOCAL_STORAGE_ONLY = false; // true„Å´„Åô„Çã„Å®ÂÆåÂÖ®„É≠„Éº„Ç´„É´„É¢„Éº„Éâ
        
        // „É≠„Ç∞„Ç§„É≥„Çπ„Ç≠„ÉÉ„ÉóÊôÇ„ÅÆÂàùÊúüÂåñ
        if (SKIP_LOGIN_REQUIREMENT) {
            console.log('„É≠„Ç∞„Ç§„É≥„Çπ„Ç≠„ÉÉ„Éó„É¢„Éº„Éâ„ÅßËµ∑Âãï');
            
            window.addEventListener('DOMContentLoaded', () => {
                // „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
                const logoutBtn = document.querySelector('.logout-btn');
                if (logoutBtn) {
                    logoutBtn.style.display = 'none';
                }
                
                // Ë™çË®º„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞
                const authStatus = document.getElementById('auth-status');
                if (authStatus) {
                    if (USE_LOCAL_STORAGE_ONLY) {
                        authStatus.textContent = 'üì± „É≠„Éº„Ç´„É´„É¢„Éº„Éâ';
                        authStatus.style.color = '#FF9800';
                    } else {
                        authStatus.textContent = 'üåê „Ç™„É≥„É©„Ç§„É≥„É¢„Éº„ÉâÔºà„É≠„Ç∞„Ç§„É≥‰∏çË¶ÅÔºâ';
                        authStatus.style.color = '#4CAF50';
                    }
                }
                
                // „É≠„Éº„Ç´„É´„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅÂêåÊúü„ÇíÁÑ°ÂäπÂåñ
                if (USE_LOCAL_STORAGE_ONLY) {
                    if (typeof syncManager !== 'undefined') {
                        syncManager.syncStatus.isOnline = false;
                    }
                    if (typeof db !== 'undefined') {
                        db.isOnline = false;
                    }
                }
            });
        }
    </script>
</head>
<body class="bg-cream">
    
    <!-- „Éõ„ÉØ„Ç§„Éà„Ç¢„Ç¶„Éà„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="whiteout-overlay" class="whiteout-overlay"></div>
    
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div id="app" class="min-h-screen pb-20">
        
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="sticky top-0 bg-white shadow-sm z-40 border-b border-sage-light">
            <div class="header-container">
                <!-- „É¢„Éê„Ç§„É´Áî®„É¨„Ç§„Ç¢„Ç¶„Éà -->
                <div class="header-mobile">
                    <!-- ‰∏äÊÆµÔºö„Çø„Ç§„Éà„É´„Å®„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†± -->
                    <div class="header-top-row">
                        <h1 class="header-title">
                            <i class="fas fa-leaf text-sage"></i>
                            „Ç™„Éº„ÉÄ„Éº„Ç∑„Éº„Éà ver.0.9
                        </h1>
                        <div class="header-user-info">
                            <div id="auth-status" class="auth-status-text"></div>
                            <div class="header-action-buttons">
                                <button onclick="app.syncData()" class="header-icon-btn" title="„Éá„Éº„ÇøÂêåÊúü">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button onclick="handleLogout()" class="header-icon-btn logout-btn" title="„É≠„Ç∞„Ç¢„Ç¶„Éà">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- ‰∏ãÊÆµÔºö„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="header-actions">
                        <button id="input-btn" onclick="app.openNewOrderForm()" class="input-header-btn">
                            <i class="fas fa-plus-circle mr-1 animate-pulse"></i>ÂèóÊ≥®ÂÖ•Âäõ
                        </button>
                        <button id="incomplete-count-btn" onclick="app.showIncompleteTab()" class="incomplete-header-btn">
                            <i class="fas fa-exclamation-circle mr-1"></i>
                            Êú™ÂÆå‰∫Ü <span id="incomplete-count-text">0</span>‰ª∂
                        </button>
                    </div>
                </div>

                <!-- „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÁî®„É¨„Ç§„Ç¢„Ç¶„ÉàÔºà641px‰ª•‰∏äÔºâ -->
                <div class="header-desktop">
                    <div class="flex items-center gap-3">
                        <h1 class="text-xl font-bold text-forest flex items-center gap-2">
                            <i class="fas fa-leaf text-sage"></i>
                            „Ç™„Éº„ÉÄ„Éº„Ç∑„Éº„Éà ver.0.9
                        </h1>
                        <div class="flex gap-2">
                            <button id="input-btn-desktop" onclick="app.openNewOrderForm()" class="input-header-btn">
                                <i class="fas fa-plus-circle mr-1 animate-pulse"></i>ÂèóÊ≥®ÂÖ•Âäõ
                            </button>
                            <button id="incomplete-count-btn-desktop" onclick="app.showIncompleteTab()" class="incomplete-header-btn">
                                <i class="fas fa-exclamation-circle mr-1"></i>
                                Êú™ÂÆå‰∫Ü <span class="incomplete-count-text">0</span>‰ª∂
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <div class="header-action-buttons">
                            <button onclick="app.syncData()" class="p-2 text-sage hover:text-sage-dark transition" title="„Éá„Éº„ÇøÂêåÊúü">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button onclick="handleLogout()" class="p-2 text-red-500 hover:text-red-600 transition" title="„É≠„Ç∞„Ç¢„Ç¶„Éà">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                        <div class="auth-status-text-desktop"></div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <nav class="bg-white border-b border-sage-light sticky top-14 z-30">
            <div class="container mx-auto px-4">
                <div class="flex overflow-x-auto scrollbar-hide">
                    <button class="tab-btn today-tab active" data-tab="today">
                        <i class="fas fa-calendar-day mr-1"></i>Êú¨Êó• <span id="today-count" class="badge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="dryflower">
                        <i class="fas fa-flower mr-1"></i>„Éâ„É©„Ç§„Éï„É©„ÉØ„Éº
                    </button>
                    <button class="tab-btn" data-tab="plant">
                        <i class="fas fa-seedling mr-1"></i>Ê§çÁâ©
                    </button>
                    <button class="tab-btn" data-tab="all">
                        <i class="fas fa-list mr-1"></i>ÂÖ®„Ç™„Éº„ÉÄ„Éº
                    </button>
                    <button class="tab-btn" data-tab="search">
                        <i class="fas fa-search mr-1"></i>Ê§úÁ¥¢
                    </button>
                    <button class="tab-btn" data-tab="completed">
                        <i class="fas fa-check-circle mr-1"></i>ÂÆå‰∫ÜÊ∏à„Åø
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="container mx-auto px-4 py-6">
            
            <!-- ÂèóÊ≥®ÂÖ•Âäõ„Çø„Éñ -->
            <div id="tab-input" class="tab-content">
                <form id="order-form" class="space-y-6">
                    
                    <!-- „Çπ„ÉÜ„ÉÉ„Éó1: ÂèóÊ≥®ÊÉÖÂ†± -->
                    <div class="step-section active" id="step-1">
                        <h2 class="section-title">
                            <i class="fas fa-info-circle text-sage mr-2"></i>
                            ÂèóÊ≥®ÊÉÖÂ†±
                        </h2>
                        
                        <!-- ÈÄ£Áµ°ÊúüÊó•„Ç¢„É©„Éº„Éà -->
                        <div id="contact-deadline-alert" class="hidden bg-orange-50 border-l-4 border-orange-400 p-3 mb-4 rounded-r">
                            <div class="flex items-start">
                                <i class="fas fa-bell text-orange-600 mr-2 mt-1"></i>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-orange-900" id="contact-deadline-message"></p>
                                    <p class="text-xs text-orange-700 mt-1" id="contact-deadline-details"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-sm p-4 space-y-4">
                            <!-- ÂèóÊ≥®Êó• -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="input-label">ÂèóÊ≥®Êó• <span class="text-red-500">*</span></label>
                                    <input type="date" id="reception-date" class="input-field" required>
                                </div>
                                <div>
                                    <label class="input-label">ÊãÖÂΩìËÄÖ</label>
                                    <select id="staff" class="input-field">
                                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <option value="Â∏ÇÂ±±">Â∏ÇÂ±±</option>
                                        <option value="‰∫îÂçÅÂµê">‰∫îÂçÅÂµê</option>
                                        <option value="Ëó§Áî∞">Ëó§Áî∞</option>
                                        <option value="Âíå‰ΩêÁî∞">Âíå‰ΩêÁî∞</option>
                                        <option value="Â∏ÇÂ±±ÂÑ™">Â∏ÇÂ±±ÂÑ™</option>
                                        <option value="Ê¢ÖÊú¨">Ê¢ÖÊú¨</option>
                                        <option value="‰∏≠Â±±">‰∏≠Â±±</option>
                                        <option value="Ëó§‰∫ï">Ëó§‰∫ï</option>
                                        <option value="„Ç≤„Çπ„Éà">„Ç≤„Çπ„Éà</option>
                                    </select>
                                    <input type="text" id="staff-other" class="input-field mt-2 hidden" placeholder="„Ç≤„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ">
                                </div>
                            </div>
                            
                            <!-- „Çµ„Éº„Éì„ÇπÂÜÖÂÆπ -->
                            <div>
                                <label class="input-label">„Çµ„Éº„Éì„ÇπÂÜÖÂÆπ <span class="text-red-500">*</span></label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="radio-label">
                                        <input type="radio" name="service" value="pickup" class="mr-2" onchange="app.updateServiceOptions()" required>
                                        <i class="fas fa-store mr-1 text-sage"></i>„ÅäÂºï„ÅçÂèñ„Çä
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="service" value="delivery" class="mr-2" onchange="app.updateServiceOptions()">
                                        <i class="fas fa-truck mr-1 text-terracotta"></i>ÈÖçÈÄÅ
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="service" value="shipping" class="mr-2" onchange="app.updateServiceOptions()">
                                        <i class="fas fa-box mr-1 text-sage-dark"></i>Áô∫ÈÄÅ
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="service" value="construction" class="mr-2" onchange="app.updateServiceOptions()">
                                        <i class="fas fa-hard-hat mr-1 text-forest"></i>Âá∫ÂºµÊñΩÂ∑•
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Êó•ÊôÇ -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="input-label" id="date-label">„ÅäÂºï„ÅçÂèñ„ÇäÊó•</label>
                                    <div class="flex gap-2">
                                        <input type="date" id="date-from" class="input-field flex-1">
                                        <span class="self-center">„Äú</span>
                                        <input type="date" id="date-to" class="input-field flex-1">
                                    </div>
                                    <label class="checkbox-label mt-2">
                                        <input type="checkbox" id="date-undecided" class="mr-2">
                                        Êó•‰ªòÊåáÂÆö„Å™„Åó
                                    </label>
                                </div>
                                <div>
                                    <label class="input-label" id="time-label">„ÅîÊù•Â∫óÊôÇÈñì</label>
                                    <div class="flex gap-2">
                                        <input type="time" id="time-from" class="input-field flex-1">
                                        <span class="self-center">„Äú</span>
                                        <input type="time" id="time-to" class="input-field flex-1">
                                    </div>
                                    <label class="checkbox-label mt-2">
                                        <input type="checkbox" id="time-undecided" class="mr-2">
                                        ÊôÇÈñìÊåáÂÆö„Å™„Åó
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Áô∫ÈÄÅÊó•ÔºàÁô∫ÈÄÅÈÅ∏ÊäûÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                            <div id="shipping-date-section" class="hidden">
                                <label class="input-label">Áô∫ÈÄÅÊó•</label>
                                <input type="date" id="shipping-date" class="input-field">
                                <p class="text-sm text-gray-500 mt-1">‚Äª ÈñãÂßãÊó•„ÅÆ„Åø„ÅÆÂÖ•Âäõ„Åß„ÇÇOK</p>
                            </div>
                            
                            <button type="button" onclick="app.nextStep(1)" class="btn-primary next-btn">
                                Ê¨°„Å∏ <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- „Çπ„ÉÜ„ÉÉ„Éó2: „Åî‰æùÈ†º‰∏ª„Éª„ÅäÂ±ä„ÅëÂÖàÊÉÖÂ†± -->
                    <div class="step-section" id="step-2">
                        <h2 class="section-title">
                            <i class="fas fa-user text-sage mr-2"></i>
                            „Åî‰æùÈ†º‰∏ª„Éª„ÅäÂ±ä„ÅëÂÖàÊÉÖÂ†±
                        </h2>
                        <div class="bg-white rounded-lg shadow-sm p-4 space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="input-label">„Åî‰æùÈ†º‰∏ªÊßò <span class="text-red-500">*</span></label>
                                    <input type="text" id="customer-name" class="input-field" placeholder="Â±±Áî∞ Â§™ÈÉé" required>
                                </div>
                                <div>
                                    <label class="input-label">ÈõªË©±Áï™Âè∑ <span class="text-red-500">*</span></label>
                                    <input type="tel" id="customer-phone" class="input-field" placeholder="090-1234-5678" required>
                                </div>
                            </div>
                            
                            <div>
                                <label class="input-label">„Åî‰ΩèÊâÄ</label>
                                <input type="text" id="customer-address" class="input-field" placeholder="Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫...">
                            </div>
                            
                            <!-- „ÅäÂ±ä„ÅëÂÖàÔºàÈÖçÈÄÅ„ÉªÁô∫ÈÄÅÊôÇ„ÅÆ„ÅøÔºâ -->
                            <div id="delivery-section" class="hidden space-y-4 pt-4 border-t">
                                <h3 class="font-bold text-sage-dark">„ÅäÂ±ä„ÅëÂÖàÊÉÖÂ†±</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="input-label">„ÅäÂ±ä„ÅëÂÖàÊßò</label>
                                        <input type="text" id="delivery-name" class="input-field">
                                    </div>
                                    <div>
                                        <label class="input-label">ÈõªË©±Áï™Âè∑</label>
                                        <input type="tel" id="delivery-phone" class="input-field">
                                    </div>
                                </div>
                                <div>
                                    <label class="input-label">„ÅäÂ±ä„ÅëÂÖà‰ΩèÊâÄ</label>
                                    <input type="text" id="delivery-address" class="input-field">
                                </div>
                            </div>
                            
                            <button type="button" onclick="app.nextStep(2)" class="btn-primary next-btn">
                                Ê¨°„Å∏ <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- „Çπ„ÉÜ„ÉÉ„Éó3: ÂïÜÂìÅ„ÇíËøΩÂä† -->
                    <div class="step-section" id="step-3">
                        <h2 class="section-title">
                            <i class="fas fa-shopping-cart text-sage mr-2"></i>
                            ÂïÜÂìÅ„ÇíËøΩÂä†
                        </h2>
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            
                            <!-- ÂïÜÂìÅ„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû -->
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <button type="button" onclick="app.showProductForm('dryflower')" class="category-btn bg-gradient-to-br from-terracotta to-terracotta-light">
                                    <i class="fas fa-spa text-3xl mb-2"></i>
                                    <span>„Éâ„É©„Ç§„Éï„É©„ÉØ„Éº</span>
                                </button>
                                <button type="button" onclick="app.showProductForm('plant')" class="category-btn bg-gradient-to-br from-sage to-sage-light">
                                    <i class="fas fa-leaf text-3xl mb-2"></i>
                                    <span>Ë¶≥ËëâÊ§çÁâ©</span>
                                </button>
                                <button type="button" onclick="app.showProductForm('tree')" class="category-btn bg-gradient-to-br from-forest to-sage-dark">
                                    <i class="fas fa-tree text-3xl mb-2"></i>
                                    <span>Ê§çÊú®</span>
                                </button>
                            </div>
                            
                            <!-- ÂïÜÂìÅËøΩÂä†„Éï„Ç©„Éº„É†ÔºàÂãïÁöÑË°®Á§∫Ôºâ -->
                            <div id="product-form-container" class="hidden">
                                <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                            </div>
                            
                            <!-- ËøΩÂä†Ê∏à„ÅøÂïÜÂìÅ„É™„Çπ„Éà -->
                            <div id="added-products" class="space-y-3 mt-6">
                                <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                            </div>
                            
                            <!-- ÈÄÅÊñô -->
                            <div id="shipping-cost-section" class="mt-4 pt-4 border-t hidden">
                                <div class="flex justify-between items-center">
                                    <label class="font-medium text-sage-dark">
                                        <i class="fas fa-truck mr-2"></i>ÈÄÅÊñô
                                    </label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" id="shipping-cost" class="input-field w-32" value="0" min="0" step="10">
                                        <span class="text-gray-600">ÂÜÜ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÂïÜÂìÅÂÇôËÄÉ -->
                            <div class="mt-4 pt-4 border-t">
                                <label class="input-label">
                                    <i class="fas fa-sticky-note mr-2 text-sage"></i>ÂïÜÂìÅÂÇôËÄÉÔºàÈÄ£Áµ°ÊúüÊó•„ÇÑÁâπË®ò‰∫ãÈ†ÖÔºâ
                                </label>
                                <textarea id="product-notes" class="input-field" rows="3" placeholder="ÈÄ£Áµ°ÊúüÊó•„ÄÅÁâπË®ò‰∫ãÈ†Ö„ÄÅÈÖçÈÄÅ‰∏ä„ÅÆÊ≥®ÊÑè‰∫ãÈ†Ö„Å™„Å©"></textarea>
                                <p class="text-xs text-gray-500 mt-1">‚Äª „Åì„ÅÆÊ¨Ñ„ÅØÂïÜÂìÅ„Å´Èñ¢„Åô„ÇãÂÇôËÄÉ„Åß„Åô„ÄÇÂÖ®‰Ωì„ÅÆÂÇôËÄÉ„ÅØÊ¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅßÂÖ•Âäõ„Åß„Åç„Åæ„Åô„ÄÇ</p>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t">
                                <button type="button" onclick="app.nextStep(3)" class="btn-primary next-btn">
                                    Ê¨°„Å∏ <i class="fas fa-arrow-right ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- „Çπ„ÉÜ„ÉÉ„Éó4: ÂÇôËÄÉ„ÉªÂêàË®à -->
                    <div class="step-section" id="step-4">
                        <h2 class="section-title">
                            <i class="fas fa-calculator text-sage mr-2"></i>
                            ÂÇôËÄÉ„ÉªÂêàË®à
                        </h2>
                        <div class="bg-white rounded-lg shadow-sm p-4 space-y-4">
                            
                            <!-- „Éá„Ç£„Çπ„Ç´„Ç¶„É≥„Éà -->
                            <div>
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" id="discount-check" class="mr-2" onchange="app.toggleDiscountField()">
                                    <span class="input-label mb-0">„Éá„Ç£„Çπ„Ç´„Ç¶„É≥„Éà„ÅÇ„Çä</span>
                                </label>
                                <div id="discount-field" class="hidden">
                                    <div class="flex gap-2">
                                        <input type="number" id="discount" class="input-field flex-1" placeholder="0" min="0" step="10" oninput="app.updateTotal()">
                                        <span class="flex items-center text-gray-600">ÂÜÜ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÂÇôËÄÉ -->
                            <div>
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" id="notes-check" class="mr-2" onchange="app.toggleNotesField()">
                                    <span class="input-label mb-0">ÂÇôËÄÉ„ÅÇ„Çä</span>
                                </label>
                                <div id="notes-field" class="hidden">
                                    <textarea id="notes" class="input-field" rows="3" placeholder="ÁâπË®ò‰∫ãÈ†Ö„ÇíÂÖ•Âäõ"></textarea>
                                </div>
                            </div>
            
                            <!-- ÂêàË®àË°®Á§∫ -->
                            <div class="bg-cream rounded-lg p-4">
                                <h3 class="font-bold text-sage-dark mb-3">ÊòéÁ¥∞</h3>
                                <div id="order-summary" class="space-y-2 text-sm">
                                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                                </div>
                            </div>
                            
                            <!-- ÊîØÊâï„ÅÑÊÉÖÂ†± -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="input-label">„ÅäÊîØÊâï„ÅÑ</label>
                                    <select id="payment-status" class="input-field">
                                        <option value="Êú™">Êú™</option>
                                        <option value="Ê∏à">Ê∏à</option>
                                    </select>
                                </div>
                                <div id="payment-date-container">
                                    <label class="input-label">ÊîØÊâï„ÅÑÊó•</label>
                                    <input type="date" id="payment-date" class="input-field" disabled>
                                </div>
                                <div id="payment-staff-container">
                                    <label class="input-label">ÊãÖÂΩìËÄÖ</label>
                                    <select id="payment-staff" class="input-field" disabled>
                                        <option value="">ÈÅ∏Êäû</option>
                                        <option value="Â∏ÇÂ±±">Â∏ÇÂ±±</option>
                                        <option value="‰∫îÂçÅÂµê">‰∫îÂçÅÂµê</option>
                                        <option value="Ëó§Áî∞">Ëó§Áî∞</option>
                                        <option value="Âíå‰ΩêÁî∞">Âíå‰ΩêÁî∞</option>
                                        <option value="Â∏ÇÂ±±ÂÑ™">Â∏ÇÂ±±ÂÑ™</option>
                                        <option value="Ê¢ÖÊú¨">Ê¢ÖÊú¨</option>
                                        <option value="‰∏≠Â±±">‰∏≠Â±±</option>
                                        <option value="Ëó§‰∫ï">Ëó§‰∫ï</option>
                                        <option value="„Ç≤„Çπ„Éà">„Ç≤„Çπ„Éà</option>
                                    </select>
                                    <input type="text" id="payment-staff-other" class="input-field mt-2 hidden" placeholder="„Ç≤„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ" disabled>
                                </div>
                            </div>

                            <!-- ÁùÄÊâãÊÉÖÂ†±ÔºàÁ∑®ÈõÜÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                            <div id="work-section" class="hidden">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="work-started" class="mr-2">
                                    ÁùÄÊâãÊ∏à„Åø„Å´„Åô„Çã
                                </label>
                                <div id="work-details" class="hidden mt-3 space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="input-label">ÊãÖÂΩìËÄÖÈÅ∏Êäû</label>
                                            <select id="work-staff" class="input-field">
                                                <option value="">ÈÅ∏Êäû</option>
                                                <option value="Â∏ÇÂ±±">Â∏ÇÂ±±</option>
                                                <option value="‰∫îÂçÅÂµê">‰∫îÂçÅÂµê</option>
                                                <option value="Ëó§Áî∞">Ëó§Áî∞</option>
                                                <option value="Âíå‰ΩêÁî∞">Âíå‰ΩêÁî∞</option>
                                                <option value="Â∏ÇÂ±±ÂÑ™">Â∏ÇÂ±±ÂÑ™</option>
                                                <option value="Ê¢ÖÊú¨">Ê¢ÖÊú¨</option>
                                                <option value="‰∏≠Â±±">‰∏≠Â±±</option>
                                                <option value="Ëó§‰∫ï">Ëó§‰∫ï</option>
                                                <option value="„Ç≤„Çπ„Éà">„Ç≤„Çπ„Éà</option>
                                            </select>
                                            <input type="text" id="work-staff-other" class="input-field mt-2 hidden" placeholder="„Ç≤„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ">
                                        </div>
                                        <div>
                                            <label class="input-label">ÁùÄÊâãÊó•ÊôÇ</label>
                                            <input type="datetime-local" id="work-datetime" class="input-field" readonly>
                                        </div>
                                    </div>
                                    
                                    <!-- ‰ΩúÊ•≠Áä∂ÊÖã -->
                                    <div>
                                        <label class="input-label">‰ΩúÊ•≠Áä∂ÊÖã</label>
                                        <select id="work-status" class="input-field">
                                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                            <option value="ÊùêÊñôÈõÜ„ÇÅÊ∏à">ÊùêÊñôÈõÜ„ÇÅÊ∏à</option>
                                            <option value="Âà∂‰Ωú‰∏≠">Âà∂‰Ωú‰∏≠</option>
                                            <option value="Âà∂‰ΩúÊ∏à">Âà∂‰ΩúÊ∏à</option>
                                            <option value="„É©„ÉÉ„Éî„É≥„Ç∞Ê∏à">„É©„ÉÉ„Éî„É≥„Ç∞Ê∏à</option>
                                            <option value="Ê¢±ÂåÖÊ∏à">Ê¢±ÂåÖÊ∏à</option>
                                            <option value="Ê∫ñÂÇôÂÆå‰∫Ü">Ê∫ñÂÇôÂÆå‰∫Ü</option>
                                        </select>
                                        
                                        <!-- ÂàùÂõûÊ±∫ÂÆö„Éú„Çø„É≥ -->
                                        <button type="button" id="confirm-work-status-btn" class="btn-primary btn-small mt-2 hidden" onclick="app.confirmWorkStatus()">
                                            <i class="fas fa-check mr-1"></i>‰ΩúÊ•≠Áä∂ÊÖã„ÇíÊ±∫ÂÆö
                                        </button>
                                        
                                        <!-- ‰ΩúÊ•≠Áä∂ÊÖãÂ±•Ê≠¥ -->
                                        <div id="work-status-history" class="mt-2 space-y-1 text-sm text-gray-600"></div>
                                        <button type="button" id="add-work-status-btn" class="btn-secondary btn-small mt-2 hidden" onclick="app.addWorkStatus()">
                                            <i class="fas fa-plus mr-1"></i>‰ΩúÊ•≠Áä∂ÊÖã„ÇíËøΩÂä†
                                        </button>
                                    </div>
                                    
                                    <!-- ÈÄ£Áµ°Ë®òÈå≤ -->
                                    <div>
                                        <label class="input-label">ÈÄ£Áµ°Ë®òÈå≤</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <select id="contact-record" class="input-field">
                                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="ÈõªË©±ÈÄ£Áµ°Ê∏à">ÈõªË©±ÈÄ£Áµ°Ê∏à</option>
                                                <option value="‰∏çÂú®(ÁïôÂÆàÈõª)">‰∏çÂú®(ÁïôÂÆàÈõª)</option>
                                                <option value="‰∏çÂú®(ÁïôÂÆàÈõª„Å™„Åó)">‰∏çÂú®(ÁïôÂÆàÈõª„Å™„Åó)</option>
                                                <option value="„É°„Éº„É´Ê∏à">„É°„Éº„É´Ê∏à</option>
                                                <option value="DMÊ∏à">DMÊ∏à</option>
                                            </select>
                                            <select id="contact-record-staff" class="input-field">
                                                <option value="">ÊãÖÂΩìËÄÖÈÅ∏Êäû</option>
                                                <option value="Â∏ÇÂ±±">Â∏ÇÂ±±</option>
                                                <option value="‰∫îÂçÅÂµê">‰∫îÂçÅÂµê</option>
                                                <option value="Ëó§Áî∞">Ëó§Áî∞</option>
                                                <option value="Âíå‰ΩêÁî∞">Âíå‰ΩêÁî∞</option>
                                                <option value="Â∏ÇÂ±±ÂÑ™">Â∏ÇÂ±±ÂÑ™</option>
                                                <option value="Ê¢ÖÊú¨">Ê¢ÖÊú¨</option>
                                                <option value="‰∏≠Â±±">‰∏≠Â±±</option>
                                                <option value="Ëó§‰∫ï">Ëó§‰∫ï</option>
                                                <option value="„Ç≤„Çπ„Éà">„Ç≤„Çπ„Éà</option>
                                            </select>
                                        </div>
                                        <input type="text" id="contact-record-staff-other" class="input-field mt-2 hidden" placeholder="„Ç≤„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ">
                                        
                                        <!-- ÂàùÂõûÊ±∫ÂÆö„Éú„Çø„É≥ -->
                                        <button type="button" id="confirm-contact-record-btn" class="btn-primary btn-small mt-2 hidden" onclick="app.confirmContactRecord()">
                                            <i class="fas fa-check mr-1"></i>ÈÄ£Áµ°Ë®òÈå≤„ÇíÊ±∫ÂÆö
                                        </button>
                                        
                                        <!-- ÈÄ£Áµ°Ë®òÈå≤Â±•Ê≠¥ -->
                                        <div id="contact-record-history" class="mt-2 space-y-1 text-sm text-gray-600"></div>
                                        <button type="button" id="add-contact-record-btn" class="btn-secondary btn-small mt-2 hidden" onclick="app.addContactRecord()">
                                            <i class="fas fa-plus mr-1"></i>ÈÄ£Áµ°Ë®òÈå≤„ÇíËøΩÂä†
                                        </button>
                                    </div>
                                    
                                    <!-- ÂÆå‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ -->
                                    <div id="completed-section" class="mt-4 pt-4 border-t">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="completed" class="mr-2">
                                            „Åì„ÅÆ„Ç™„Éº„ÉÄ„Éº„ÇíÂÆå‰∫Ü„Å®„Åó„Å¶„Éû„Éº„ÇØ„Åô„Çã
                                        </label>
                                        <div id="completed-details" class="hidden mt-3 grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="input-label">ÂÆå‰∫ÜÊãÖÂΩìËÄÖ</label>
                                                <select id="completed-staff" class="input-field">
                                                    <option value="">ÈÅ∏Êäû</option>
                                                    <option value="Â∏ÇÂ±±">Â∏ÇÂ±±</option>
                                                    <option value="‰∫îÂçÅÂµê">‰∫îÂçÅÂµê</option>
                                                    <option value="Ëó§Áî∞">Ëó§Áî∞</option>
                                                    <option value="Âíå‰ΩêÁî∞">Âíå‰ΩêÁî∞</option>
                                                    <option value="Â∏ÇÂ±±ÂÑ™">Â∏ÇÂ±±ÂÑ™</option>
                                                    <option value="Ê¢ÖÊú¨">Ê¢ÖÊú¨</option>
                                                    <option value="‰∏≠Â±±">‰∏≠Â±±</option>
                                                    <option value="Ëó§‰∫ï">Ëó§‰∫ï</option>
                                                    <option value="„Ç≤„Çπ„Éà">„Ç≤„Çπ„Éà</option>
                                                </select>
                                                <input type="text" id="completed-staff-other" class="input-field mt-2 hidden" placeholder="„Ç≤„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ">
                                            </div>
                                            <div>
                                                <label class="input-label">ÂÆå‰∫ÜÊó•ÊôÇ</label>
                                                <input type="datetime-local" id="completed-datetime" class="input-field" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ‰øùÂ≠ò„Éª„Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥ -->
                            <div class="flex gap-3">
                                <button type="button" onclick="app.clearForm()" class="btn-secondary flex-1">
                                    <i class="fas fa-times mr-2"></i>„Ç≠„É£„É≥„Çª„É´
                                </button>
                                <button type="submit" id="save-button" class="btn-primary flex-1 hidden">
                                    <i class="fas fa-save mr-2"></i>‰øùÂ≠ò
                                </button>
                            </div>
                            
                            <!-- ÂâäÈô§„Éú„Çø„É≥ÔºàÁ∑®ÈõÜÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                            <div id="delete-section" class="hidden mt-8 pt-8 border-t border-gray-200">
                                <!-- ÂàùÊúüË°®Á§∫ÔºöÂ∞è„Åï„Å™ÂâäÈô§„Éú„Çø„É≥ -->
                                <div id="delete-initial" class="text-center">
                                    <label class="inline-flex items-center cursor-pointer group">
                                        <input type="checkbox" id="delete-check" class="mr-2" onchange="app.toggleDeleteConfirm()">
                                        <span class="text-sm text-gray-500 group-hover:text-red-600 transition">
                                            „Åì„ÅÆ„Ç™„Éº„ÉÄ„Éº„ÇíÂâäÈô§„Åô„Çã
                                        </span>
                                    </label>
                                </div>
                                
                                <!-- „ÉÅ„Çß„ÉÉ„ÇØÂæåË°®Á§∫ÔºöË≠¶Âëä„Å®Â§ß„Åç„Å™„Éú„Çø„É≥ -->
                                <div id="delete-confirm" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mt-4 animate-pulse-once">
                                    <h3 class="text-red-800 font-bold mb-2">
                                        <i class="fas fa-exclamation-triangle mr-2"></i>Âç±Èô∫„Å™Êìç‰Ωú
                                    </h3>
                                    <p class="text-sm text-red-700 mb-4">
                                        „Åì„ÅÆ„Ç™„Éº„ÉÄ„Éº„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                    </p>
                                    <button type="button" onclick="app.confirmDelete()" class="btn-danger w-full">
                                        <i class="fas fa-trash-alt mr-2"></i>„Åì„ÅÆ„Ç™„Éº„ÉÄ„Éº„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åô„Çã
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </form>
            </div>
            
            <!-- „Åù„ÅÆ‰ªñ„ÅÆ„Çø„Éñ -->
            <!-- Êú¨Êó•„Çø„Éñ -->
            <div id="tab-today" class="tab-content">
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4 rounded-r">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-day text-yellow-600 mr-2"></i>
                        <div>
                            <p class="font-bold text-gray-900" id="today-date"></p>
                            <p class="text-sm text-gray-600">Êú¨Êó•„ÅÆ„ÅäÂºï„ÅçÂèñ„Çä„ÉªÈÖçÈÄÅÂ∏åÊúõ„ÉªÁô∫ÈÄÅ„ÉªÊñΩÂ∑•‰∫àÂÆö</p>
                        </div>
                    </div>
                </div>
                <div class="order-list" id="today-orders">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
            <div id="tab-dryflower" class="tab-content">
                <!-- „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥ -->
                <div class="bg-white rounded-lg shadow-sm p-3 mb-4">
                    <div class="flex flex-wrap gap-2" id="dryflower-filters">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fas fa-list mr-1"></i>ÂÖ®„Å¶ <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="pickup">
                            <i class="fas fa-clock mr-1"></i>ÂºïÂèñÂæÖ„Å° <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="production">
                            <i class="fas fa-hammer mr-1"></i>Âà∂‰ΩúÊú™ <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="prepare">
                            <i class="fas fa-box mr-1"></i>Ê∫ñÂÇôÊú™ <span class="filter-count"></span>
                        </button>
                    </div>
                </div>
                <div class="order-list" id="dryflower-orders">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
            <div id="tab-plant" class="tab-content">
                <!-- „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥ -->
                <div class="bg-white rounded-lg shadow-sm p-3 mb-4">
                    <div class="flex flex-wrap gap-2" id="plant-filters">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fas fa-list mr-1"></i>ÂÖ®„Å¶ <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="pickup">
                            <i class="fas fa-clock mr-1"></i>ÂºïÂèñÂæÖ„Å° <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="work">
                            <i class="fas fa-hands mr-1"></i>Ê§çÊõøÊú™ <span class="filter-count"></span>
                        </button>
                        <button class="filter-btn" data-filter="prepare">
                            <i class="fas fa-box mr-1"></i>Ê∫ñÂÇôÊú™ <span class="filter-count"></span>
                        </button>
                    </div>
                </div>
                <div class="order-list" id="plant-orders">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            

            <div id="tab-all" class="tab-content">
                <div class="order-list" id="all-orders">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
            <div id="tab-search" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="input-label">Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ</label>
                            <input type="text" id="search-keyword" class="input-field" placeholder="ÂêçÂâç„ÄÅÂïÜÂìÅÂêç„ÄÅÂÇôËÄÉ„ÄÅ‰ΩèÊâÄ„Å™„Å©‰Ωï„Åß„ÇÇÊ§úÁ¥¢">
                        </div>
                        <div>
                            <label class="input-label">Áä∂ÊÖã</label>
                            <select id="search-status" class="input-field">
                                <option value="">„Åô„Åπ„Å¶</option>
                                <option value="incomplete">Êú™ÂÆå‰∫Ü</option>
                                <option value="completed">ÂÆå‰∫ÜÊ∏à„Åø</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="app.searchOrders()" class="btn-primary w-full">
                                <i class="fas fa-search mr-2"></i>Ê§úÁ¥¢
                            </button>
                        </div>
                    </div>
                </div>
                <div id="search-result-info" class="hidden mb-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r">
                    <p class="text-sm text-blue-900">
                        <i class="fas fa-info-circle mr-2"></i>
                        <span id="search-result-count"></span>
                    </p>
                </div>
                <div class="order-list" id="search-results">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
            <div id="tab-completed" class="tab-content">
                <div class="order-list" id="completed-orders">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
            
        </main>
        
        <!-- „É¢„Éº„ÉÄ„É´ -->
        <div id="modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title" class="text-lg font-bold text-forest"></h3>
                    <button onclick="app.closeModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="modal-body" class="modal-body">
                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
            </div>
        </div>
        
        <!-- „Éà„Éº„Çπ„ÉàÈÄöÁü• -->
        <div id="toast" class="toast hidden">
            <span id="toast-message"></span>
        </div>
        
        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
        </div>
        
    </div>
    
    <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ -->
    <script src="app.js"></script>
    
    <!-- FirebaseË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ -->
    <script>
        // „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
        async function handleLogout() {
            try {
                const authManager = getAuthManager();
                if (authManager) {
                    const result = await authManager.signOut();
                    if (result.success) {
                        console.log('Logout successful');
                        window.location.href = 'login.html';
                    } else {
                        console.error('Logout failed:', result.error);
                        alert('„É≠„Ç∞„Ç¢„Ç¶„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + result.error);
                    }
                }
            } catch (error) {
                console.error('Logout error:', error);
                alert('„É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        }

        // „É™„ÉÄ„Ç§„É¨„ÇØ„Éà„Éï„É©„Ç∞ÔºàÁÑ°Èôê„É´„Éº„ÉóÈò≤Ê≠¢Ôºâ
        let isRedirecting = false;

        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„ÅÆË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('Index page: Starting Firebase authentication check');
            
            // „É≠„Ç∞„Ç§„É≥„Çπ„Ç≠„ÉÉ„Éó„É¢„Éº„Éâ„ÅÆÁ¢∫Ë™ç
            if (SKIP_LOGIN_REQUIREMENT) {
                console.log('Index page: Login skip mode enabled');
                // „Ç¢„Éó„É™ÂàùÊúüÂåñ
                initializeApp();
                return;
            }
            
            try {
                // 1. FirebaseÂàùÊúüÂåñ„ÇíÂæÖ„Å§
                await initializeFirebase();
                const authManager = await initializeAuthManager();
                
                // 2. FirebaseAdapter„ÅÆÂàùÊúüÂåñ„ÇíÂæÖ„Å§ÔºàÈáçË¶ÅÔºÅÔºâ
                await initializeFirebaseAdapter();
                
                if (!authManager) {
                    console.log('Index page: No AuthManager, redirecting to login');
                    if (!isRedirecting) {
                        isRedirecting = true;
                        window.location.href = 'login.html';
                    }
                    return;
                }
                
                console.log('Index page: Firebase AuthManager initialized');
                
                // 3. Ë™çË®ºÁä∂ÊÖã„ÅÆÂÆâÂÆöÂåñ„ÇíÂæÖ„Å§ÔºàÈáçË¶ÅÔºÅÔºâ
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 4. Ë™çË®ºÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
                const user = authManager.getCurrentUser();
                console.log('Index page: Current user after wait', user);
                
                if (!user) {
                    console.log('Index page: No user found, redirecting to login');
                    if (!isRedirecting) {
                        isRedirecting = true;
                        window.location.href = 'login.html';
                    }
                    return;
                }
                
                console.log('Index page: User authenticated:', user.email);
                
                // 5. „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÂàùÊúüÂåñÔºàFirebaseÂÆåÂÖ®ÂàùÊúüÂåñÂæåÔºâ
                const app = initializeApp();
                if (app && app.initWithUser) {
                    app.initWithUser(user);
                }
                
            } catch (error) {
                console.error('Index page: Firebase authentication check failed', error);
                if (!isRedirecting) {
                    isRedirecting = true;
                    window.location.href = 'login.html';
                }
            }
        });
    </script>
</body>
</html>